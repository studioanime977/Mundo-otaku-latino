<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exportar PNG Otaku Latino</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#111; color:#eee; display:flex; align-items:center; justify-content:center; min-height:100vh; margin:0; }
    .card { background:#1a1a1a; padding:24px; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35); width:min(860px, 96vw); }
    .row { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
    canvas { background:transparent; border:1px dashed #555; border-radius:10px; width:100%; height:auto; }
    button { background:linear-gradient(45deg,#6a5af9,#a24bf6,#ff5cad,#ff2f7d); color:#fff; border:none; padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:700; }
    label { display:block; margin:10px 0 6px; color:#bbb; }
    input[type="range"] { width:240px; }
    input[type="color"] { height:36px; border-radius:8px; border:none; }
    .controls { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:16px; }
  </style>
</head>
<body>
  <div class="card">
    <h2 style="margin-top:0">Generar PNG "Otaku Latino" con tu logo</h2>
    <p>Si al convertir no se ve el logo, usa fondo blanco o aumenta el trazo del texto. Exporta con un clic.</p>
    <div class="controls">
      <div>
        <label>Tamaño (ancho px)</label>
        <input id="w" type="range" min="300" max="1600" step="10" value="600" />
        <span id="wVal">600</span>
      </div>
      <div>
        <label>Altura (px)</label>
        <input id="h" type="range" min="150" max="500" step="10" value="230" />
        <span id="hVal">230</span>
      </div>
      <div>
        <label>Altura logo (%)</label>
        <input id="logoPct" type="range" min="40" max="100" step="1" value="100" />
        <span id="logoPctVal">100%</span>
      </div>
      <div>
        <label>Grosor del borde del texto</label>
        <input id="stroke" type="range" min="0" max="10" step="0.5" value="3" />
        <span id="strokeVal">3</span>
      </div>
      <div>
        <label>Fondo</label>
        <div class="row">
          <input id="bgEnable" type="checkbox" />
          <span>Usar color</span>
          <input id="bgColor" type="color" value="#ffffff" />
          <button id="bgNone" type="button">Transparente</button>
        </div>
      </div>
    </div>

    <div class="row" style="margin:12px 0 16px;">
      <button id="dl">Descargar PNG</button>
    </div>
    <canvas id="c" width="600" height="230" aria-label="previsualización"></canvas>
  </div>

  <script>
    const logoSrc = './logo.png'; // Fallback
    const icoSrc  = './log.ico';  // Preferido
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const wInput = document.getElementById('w');
    const hInput = document.getElementById('h');
    const lpInput = document.getElementById('logoPct');
    const wVal = document.getElementById('wVal');
    const hVal = document.getElementById('hVal');
    const lpVal = document.getElementById('logoPctVal');
    const strokeInput = document.getElementById('stroke');
    const strokeVal = document.getElementById('strokeVal');
    const bgEnable = document.getElementById('bgEnable');
    const bgColor = document.getElementById('bgColor');
    const bgNone = document.getElementById('bgNone');

    // Cargamos primero el ICO; si falla, usamos logo.png
    const ico = new Image();
    const img = new Image();
    let icoLoaded = false;
    let imgLoaded = false;
    ico.src = icoSrc;
    ico.onload = () => { icoLoaded = true; draw(); };
    ico.onerror = () => { icoLoaded = false; img.src = logoSrc; };
    img.onload = () => { imgLoaded = true; draw(); };
    img.onerror = () => { imgLoaded = false; draw(true); };

    function draw(showError = false) {
      const W = parseInt(wInput.value, 10);
      const H = parseInt(hInput.value, 10);
      canvas.width = W; canvas.height = H;
      ctx.clearRect(0,0,W,H);

      // Fondo opcional (blanco por defecto para que "se vea" en visores)
      if (bgEnable.checked) {
        ctx.fillStyle = bgColor.value;
        ctx.fillRect(0,0,W,H);
      }

      // Dibujar logo a la izquierda
      const padding = Math.round(H * 0.06);
      const logoH = Math.round(H * (lpInput.value/100));
      const baseImg = icoLoaded ? ico : img;
      const baseLoaded = icoLoaded || imgLoaded;
      const ar = (baseLoaded && baseImg.width && baseImg.height) ? (baseImg.width / baseImg.height) : 1; // fallback relación 1:1
      const logoW = Math.round(logoH * ar);
      const logoY = Math.round((H - logoH)/2);
      const logoX = padding;
      if (baseLoaded) {
        ctx.drawImage(baseImg, logoX, logoY, logoW, logoH);
      } else {
        // Marcador visual mientras carga o si falla
        ctx.fillStyle = '#222';
        ctx.fillRect(logoX, logoY, logoW || Math.round(H*0.9), logoH);
        ctx.strokeStyle = '#555';
        ctx.setLineDash([6,6]);
        ctx.strokeRect(logoX, logoY, logoW || Math.round(H*0.9), logoH);
        ctx.setLineDash([]);
        ctx.fillStyle = showError ? '#ff5cad' : '#bbb';
        ctx.font = `bold ${Math.round(H * 0.10)}px Segoe UI, Arial`;
        ctx.textBaseline = 'middle';
        ctx.fillText(showError ? 'No se pudo cargar icono' : 'Cargando icono...', logoX + 10, logoY + logoH/2);
      }

      // Texto a la derecha
      const textX = logoX + (logoW || Math.round(H*0.9)) + Math.round(H * 0.08);
      const textY = Math.round(H * 0.68);

      // Estilos de texto
      ctx.font = `bold ${Math.round(H * 0.30)}px Poppins, Segoe UI, Arial`;
      ctx.textBaseline = 'alphabetic';

      // Trazo para contraste
      const sw = parseFloat(strokeInput.value);
      if (sw > 0) {
        ctx.lineWidth = sw;
        ctx.strokeStyle = '#ffffff';
        ctx.strokeText('Mundo Otaku Latino', textX, textY);
      }

      // Relleno degradado
      const grad = ctx.createLinearGradient(textX, 0, W - padding, 0);
      grad.addColorStop(0,   '#6a5af9');
      grad.addColorStop(0.45,'#a24bf6');
      grad.addColorStop(0.75,'#ff5cad');
      grad.addColorStop(1,   '#ff2f7d');
      ctx.fillStyle = grad;
      ctx.fillText('Mundo Otaku Latino', textX, textY);
    }

    function updateLabels(){
      wVal.textContent = wInput.value;
      hVal.textContent = hInput.value;
      lpVal.textContent = `${lpInput.value}%`;
      strokeVal.textContent = strokeInput.value;
    }

    [wInput,hInput,lpInput,strokeInput,bgEnable,bgColor].forEach(inp => inp.addEventListener('input', ()=>{updateLabels(); draw();}));
    bgNone.addEventListener('click', ()=>{ bgEnable.checked = false; draw(); });

    document.getElementById('dl').addEventListener('click', () => {
      draw();
      // Método preferido: toBlob + ObjectURL (mejor memoria y compatibilidad)
      if (canvas.toBlob) {
        canvas.toBlob((blob) => {
          if (!blob) return; // Fallback si falla
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.download = 'otakulatino_logo.png';
          a.href = url;
          document.body.appendChild(a);
          a.click();
          setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 0);
        }, 'image/png');
      } else {
        // Fallback: DataURL
        const a = document.createElement('a');
        a.download = 'otakulatino_logo.png';
        a.href = canvas.toDataURL('image/png');
        document.body.appendChild(a);
        a.click();
        a.remove();
      }
    });

    updateLabels();
    // Por defecto fondo transparente
    bgEnable.checked = false;
    // Redibujo inicial aunque no haya cargado la imagen aún
    draw();
  </script>
</body>
</html>
